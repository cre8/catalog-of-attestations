{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/cre8/catalog-of-attestations/main/catalog.schema.json",
  "title": "SchemaMeta",
  "description": "A common attestation schema data model, aligned with EUDI TS11 specification with extensions for trust list verification.",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "The unique, server-assigned identifier (UUID) for the schema."
    },
    "version": {
      "type": "string",
      "description": "Version of this attestation definition (SemVer).",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-[0-9A-Za-z-.]+)?(?:\\+[0-9A-Za-z-.]+)?$"
    },
    "rulebookURI": {
      "type": "string",
      "description": "URI of the human-readable Attestation Rulebook.",
      "format": "uri"
    },
    "rulebookIntegrity": {
      "type": "string",
      "description": "Subresource Integrity (SRI) hash of the rulebook content for integrity verification. Format: 'sha256-<base64-hash>' or 'sha384-<base64-hash>' or 'sha512-<base64-hash>'.",
      "pattern": "^sha(256|384|512)-[A-Za-z0-9+/=]+$"
    },
    "trustedAuthorities": {
      "type": "array",
      "description": "Trust frameworks / trust anchors applicable to this attestation type.",
      "items": {
        "$ref": "#/$defs/TrustAuthority"
      }
    },
    "attestationLoS": {
      "type": "string",
      "description": "Level of security (LoS) of this attestation.",
      "enum": [
        "iso_18045_high",
        "iso_18045_moderate",
        "iso_18045_enhanced-basic",
        "iso_18045_basic"
      ]
    },
    "bindingType": {
      "type": "string",
      "description": "Required binding type between attestation and holder.",
      "enum": [
        "claim",
        "key",
        "biometric",
        "none"
      ]
    },
    "supportedFormats": {
      "type": "array",
      "description": "Credential formats in which this attestation is available.",
      "items": {
        "type": "string",
        "enum": [
          "dc+sd-jwt",
          "mso_mdoc",
          "jwt_vc_json",
          "jwt_vc_json-ld",
          "ldp_vc"
        ]
      },
      "minItems": 1,
      "uniqueItems": true
    },
    "schemaURIs": {
      "type": "array",
      "description": "Format-specific schema URIs for this attestation type.",
      "items": {
        "$ref": "#/$defs/Schema"
      },
      "minItems": 1
    }
  },
  "required": [
    "version",
    "rulebookURI",
    "rulebookIntegrity",
    "attestationLoS",
    "bindingType",
    "supportedFormats",
    "schemaURIs"
  ],
  "additionalProperties": false,

  "$defs": {
    "Schema": {
      "type": "object",
      "description": "Format-specific schema descriptor for the attestation.",
      "properties": {
        "formatIdentifier": {
          "type": "string",
          "description": "The credential format identifier.",
          "enum": [
            "dc+sd-jwt",
            "mso_mdoc",
            "jwt_vc_json",
            "jwt_vc_json-ld",
            "ldp_vc"
          ]
        },
        "uri": {
          "type": "string",
          "description": "Persistent schema URI for this format.",
          "format": "uri"
        },
        "integrity": {
          "type": "string",
          "description": "Subresource Integrity (SRI) hash of the schema content for integrity verification. Format: 'sha256-<base64-hash>' or 'sha384-<base64-hash>' or 'sha512-<base64-hash>'.",
          "pattern": "^sha(256|384|512)-[A-Za-z0-9+/=]+$"
        }
      },
      "required": ["formatIdentifier", "uri", "integrity"],
      "additionalProperties": false
    },

    "TrustAuthority": {
      "type": "object",
      "description": "Applicable trust framework and authority/anchor. Extended with verificationMethod for trust list signature verification.",
      "properties": {
        "frameworkType": {
          "type": "string",
          "description": "Type of trust framework.",
          "enum": [
            "aki",
            "etsi_tl",
            "openid_federation"
          ]
        },
        "value": {
          "type": "string",
          "description": "Identifier of the authority (AKI, TL URI, or federation entity identifier). For signed trust lists, this may point to a .jws file."
        },
        "isLoTE": {
          "type": "boolean",
          "description": "TRUE if frameworkType is 'etsi_tl' and the TL is a List of Trusted Entities (LoTE) per ETSI TS 119 602. FALSE if ETSI TS 119 612. Only used with etsi_tl framework type."
        },
        "verificationMethod": {
          "$ref": "#/$defs/VerificationMethod",
          "description": "[EXTENSION] Method to verify the trust list signature. Required for private/non-EU trust lists where no LOTL chain exists."
        }
      },
      "required": ["frameworkType", "value"],
      "additionalProperties": false
    },

    "VerificationMethod": {
      "type": "object",
      "description": "[EXTENSION] Verification method for trust list signature validation. Not part of TS11, added to support private trust anchors.",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of verification method.",
          "enum": [
            "JsonWebKey2020",
            "X509Certificate",
            "X509CertificateChain"
          ]
        },
        "publicKeyJwk": {
          "type": "object",
          "description": "Public key in JWK format for signature verification. Used when type is 'JsonWebKey2020'.",
          "properties": {
            "kty": { "type": "string" },
            "crv": { "type": "string" },
            "x": { "type": "string" },
            "y": { "type": "string" },
            "kid": { "type": "string" }
          },
          "required": ["kty"]
        },
        "x5u": {
          "type": "string",
          "format": "uri",
          "description": "URI to X.509 certificate or certificate chain in PEM format. Used when type is 'X509Certificate' or 'X509CertificateChain'."
        },
        "x5c": {
          "type": "array",
          "items": { "type": "string" },
          "description": "X.509 certificate chain as array of base64-encoded DER certificates. Used when type is 'X509CertificateChain'."
        }
      },
      "required": ["type"],
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "JsonWebKey2020" } }
          },
          "then": {
            "required": ["publicKeyJwk"]
          }
        },
        {
          "if": {
            "properties": { "type": { "enum": ["X509Certificate", "X509CertificateChain"] } }
          },
          "then": {
            "anyOf": [
              { "required": ["x5u"] },
              { "required": ["x5c"] }
            ]
          }
        }
      ]
    }
  }
}
